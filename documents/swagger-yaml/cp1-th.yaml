swagger: '2.0'
info:
  version: '0.1'
  title: 'cmu mars brass th: phase 2, cp1'
schemes:
  - http
host: brass-th
paths:
  /ready:
    post:
      description: >-
        indicate to the TH that the TA is ready to recieve configuration data to
        continue starting up the DAS
      responses:
        '200':
          description: TH is ready to produce configuration data
          schema:
            type: object
            required:
              - level
              - start-loc
              - target-locs
            properties:
              level:
                description: |-
                  the level at which the DAS should operate for this test.
                  as given in the CP definition,

                    * a - no perturbations, no adaptation, no power model
                    * b - perturbations, but no adaptation, no power model
                    * c - perturbations and adaptation, but a static power
                          model for discharge/charge, while planner uses a
                          different static power model
                    * d - perturbations and adaptation, with charge and
                          discharge power models provided and learned
                type: string
                enum:
                  - a
                  - b
                  - c
                  - d
              start-loc:
                type: string
                description: the name of the start map waypoint
              target-locs:
                type: array
                items:
                  type: string
                description: >-
                  the names of the waypoints to visit, in the order in
                  which they must be visited. each name must be a valid
                  name of a waypoint on the map
              discharge-function:
                type: string
                format: function_spec
                description: >-
                  if in level d, a description of the function dictating
                  the discharge of the battery, which is what we will
                  learn.  TODO - this cant be a string
              discharge-budget:
                type: integer
                description: >-
                  if in level d, the maximum number of queries against the
                  target function during learning
              charge-function:
                type: string
                format: function_spec
                description: >-
                  if in level d, a description of the function dictating
                  the recharging of the battery, which is what we will
                  learn. TODO - this cant be a string
              charge-budget:
                type: integer
                description: >-
                  if in level d, the maximum number of queries against the
                  target recharging function during learning
        '400':
          description: TH encountered an error producing configuration data
  /error:
    post:
      description: >-
        used by the TA to indicate to the TH that an error has occurred in the
        start up or learning process. the TH will terminate the test upon
        notification of an error
      parameters:
        - in: body
          name: Parameters
          schema:
            type: object
            required:
              - error
            properties:
              error:
                description: |-
                  TODO -- add more error codes for other possible problems

                  one of a enumerated set of reasons that errors may arise
                   * parsing-error - one or more of the function
                                     descriptions failed to parse
                   * learning-error - an error was encountered in learning
                                      one or more of the hidden functions
                   * other-error - an error was encountered that is not
                                   covered by the other error codees
                type: string
                enum:
                  - parsing-error
                  - learning-error
                  - other-error
              message:
                description: |-
                  human readable text describing the error, if available
                type: string
      responses:
        '200':
          description: TH acknowledges the error and is shutting down the test
  /status:
    post:
      description: used by the TA to periodically indicate its current state to the TH
      parameters:
        - in: body
          name: Parameters
          schema:
            type: object
            required:
              - status
              - sim_time
              - x
              - 'y'
              - v
              - w
              - charge
              - predicted_arrival
            properties:
              status:
                description: |-
                  one of the possible status codes
                   * learning-started - the learning phase has started
                   * learning-done - the learning phase has been
                   * adapt-started - the SUT has started adapting and
                                     cannot be perturbed
                   * adapt-done - the SUT has finished adapting
                   * charging-started - the turtlebot is currently charging
                   * charging-done - the turtlebot has stopped charging

                type: string
                enum:
                  - learning-started
                  - learning-done
                  - adapt-started
                  - adapt-done
                  - charging-started
                  - charging-done
              x:
                description: current x-coordinate of the turtlebot
                type: number
                format: float
              'y':
                description: current y-coordinate of the turtlebot
                type: number
                format: float
              w:
                description: current yaw of the turtlebot
                type: number
                format: float
              v:
                description: current velocity of the turtlebot
                type: number
                format: float
              charge:
                description: >-
                  current turtlebot battery charge in mWh TODO - are these mins
                  and maxes right?
                type: integer
                minimum: 16000
                maximum: 32000
              predicted_arrival:
                description: 'current best prediction of arrival time, in simulation time'
                type: integer
                minimum: 0
              sim_time:
                description: >-
                  the internal simulation time at the time that the status
                  message was sent
                type: integer
                minimum: 0
      responses:
        '200':
          description: TH acknowledges the status message
        '400':
          description: TH encountered an error with the status message
  /done:
    post:
      description: >-
        used by the TA to indicate to the TH that the turtlebot has reached the
        goal and that the mission has been completed. note that incomplete
        missions will result in an error and not use this end point.
      parameters:
        - in: body
          name: Parameters
          schema:
            type: object
            required:
              - x
              - 'y'
              - w
              - v
              - charge
              - sim_time
              - predicted_arrival
              - message
            properties:
              x:
                description: final x-coordinate of the turtlebot
                type: number
                format: float
              'y':
                description: final y-coordinate of the turtlebot
                type: number
                format: float
              w:
                description: final yaw of the turtlebot
                type: number
                format: float
              v:
                description: final velocity of the turtlebot
                type: number
                format: float
              charge:
                description: final charge measure of the turtlebot TODO - check ranges
                type: integer
                minimum: 16000
                maximum: 32000
              sim_time:
                description: the final internal simulation time
                type: integer
                minimum: 0
              predicted_arrival:
                description: 'final best prediction of arrival time, in simulation time'
                type: integer
                minimum: 0
              message:
                description: TODO human readable something or other
                type: string
      responses:
        '200':
          description: TH acknowledges the completion of the mission
        '400':
          description: TH encountered an error at the completion of the mission
