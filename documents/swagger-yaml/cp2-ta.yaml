swagger: '2.0'
info:
  version: '0.1'
  title: 'cmu mars brass ta: phase 2, cp2'
schemes:
  - http
host: brass-ta
definitions:
  SourceLocation:
    type: object
    properties:
      file:
        type: string
        required: true
        description: >-
          The file at which this source location resides.
      cucumber:
        type: int
        minimum: 0
        description: >-
          The character offset between the start of the file and this location.

  SourceRange:
    type: object
    properties:
      start:
        $ref: '#/definitions/SourceLocation'
        required: true
        description: >-
          The location that marks the start of this source range.
      stop:
        $ref: '#/definitions/SourceLocation'
        required: true
        description: >-
          The location that marks the end of this source range.

  Perturbation:
    type: object
    required:
      - kind
      - file
    discriminator: kind
    properties:
      kind:
        type: string
        description: >-
          Used to discriminate between different kinds of perturbation.

  DeletionPerturbation:
    type: object
    allOf:
      - $ref: '#/definitions/Perturbation'
      - properties:
          locationRange:
            $ref: '#/definitions/SourceRange'
            description: >-
              The range of code that is deleted by the perturbation.

paths:
  /perturbations:
    get:
      description: >-
        Returns a list of possible perturbations of an (optionally) specified
        shape and complexity that can be performed at a given (set of)
        location(s) in the program.  This endpoint should be used to select a
        suitable (set of) perturbation(s) for a test scenario.
      parameters:
        - in: body
          name: Parameters
          schema:
            type: object
            required:
              - file
              - shape
            properties:
              file:
                type: string
                description: >-
                  The file at which the perturbation should be injected.
              shape:
                type: string
                description: >-
                  The shape of the fault (e.g., incorrect conditional,
                  missing control flow).
              line:
                type: integer
                description: >-
                  The number of the line at which the perturbation should be
                  injected. N.b. a file must be specified.
      responses:
        '200':
          description: successfully computed the list of possible perturbations
          schema:
            type: object
            properties:
              perturbations:
                type: array
                items:
                  $ref: '#/definitions/Perturbation'
                description: >-
                  A list of perturbations that satisfy the query parameters
                  provided by the request.
        '400':
          description: >-
            Encountered an error while computing the list of possible
            perturbations.
          schema:
            type: object
            properties:
              message:
                type: string
                description: >-
                  human-readable information about the error, if any can be
                  provided
  /adapt:
    post:
      description: Used to trigger the code adaptation process.
      parameters:
        - in: body
          name: Parameters
          schema:
            type: object
            properties:
              time-limit:
                type: number
                format: float
                minimum: 1.0
                required: false
                description: >-
                  An (optional) time limit for the adaptation process,
                  specified in minutes.
              attempt-limit:
                type: integer
                minimum: 1
                required: false
                description: >-
                  An (optional) limit on the number of adaptations that may be
                  attempted.
              hint:
                type: string
                required: false
                description: >-
                  We could allow hints to be provided to this method? e.g., the
                  shape(s) or location(s) of the fix(es). TODO
      responses:
        '200':
          description: successfully triggered code adaptation
        '400':
          description: encountered an error while triggering code adaptation
          schema:
            type: object
            properties:
              message:
                type: string
                description: >-
                  human-readable information about the error, if any can be
                  provided
  /perturb:
    post:
      description: >-
        Applies a set of perturbations, given as a list of JSON objects,
        to the SUT. This endpoint should be used to prepare a test scenario
        for evaluation.
      parameters:
        - in: body
          name: Parameters
          schema:
            type: object
            required:
              - perturbations
            properties:
              perturbations:
                type: array
                description: a non-empty list of perturbations to apply to the
                  codebase
                items:
                  $ref: '#/definitions/Perturbation'
      responses:
        '200':
          description: applied the perturbations to the the system successfully
        '400':
          description: encountered an error while applying the perturbations to the system
          schema:
            type: object
            properties:
              message:
                type: string
                description: >-
                  human-readable information about the error, if any can be
                  provided
  /status:
    get:
      description: Returns the current status of the SUT
      responses:
        '200':
          description: successfully computed the status of the SUT
        '400':
          description: encounted an error while computing the status of the SUT
